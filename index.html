<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Duty Registry ðŸ‡®ðŸ‡¶</title>
    <style>
        :root { --glass: rgba(255, 255, 255, 0.2); --glass-border: rgba(255, 255, 255, 0.3); }
        body { 
            margin: 0; padding: 0; height: 100vh; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            font-family: 'Poppins', sans-serif; display: flex; align-items: center; justify-content: center;
        }
        .container {
            background: var(--glass); backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px);
            border: 1px solid var(--glass-border); border-radius: 20px;
            padding: 40px; width: 90%; max-width: 400px; text-align: center; color: white;
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
        }
        input, select {
            width: 100%; padding: 12px; margin: 15px 0; border: none; border-radius: 10px;
            background: rgba(255, 255, 255, 0.1); color: white; font-size: 16px; outline: none;
        }
        option { background: #764ba2; color: white; }
        button {
            width: 100%; padding: 12px; border: none; border-radius: 10px;
            background: #4facfe; color: white; font-weight: bold; cursor: pointer; transition: 0.3s;
        }
        button:hover { background: #00f2fe; transform: translateY(-2px); }
        #formSection { display: none; }
        .loading { display: none; font-size: 12px; margin-top: 10px; }
    </style>
</head>
<body>

<div class="container">
    <h2>Medical Duty ðŸ‡®ðŸ‡¶</h2>

    <div id="loginSection">
        <input type="password" id="pass" placeholder="Enter System Password">
        <button onclick="unlock()">Access System</button>
    </div>

    <div id="formSection">
        <label>Select Specialty</label>
        <select id="specialty" onchange="fetchNames()">
            <option value="">-- Choose --</option>
            <option value="Neuro">Neuro</option>
            <option value="ThoracicSurgery">ThoracicSurgery</option>
            <option value="Uro">Uro</option>
            <option value="ENT">ENT</option>
            <option value="Cardio">Cardio</option>
            <option value="DeathCertificates">DeathCertificates</option>
            <option value="OP Anesthesia">OP Anesthesia</option>
            <option value="ICU Anesthesia">ICU Anesthesia</option>
            <option value="Radio">Radio</option>
            <option value="Onco">Onco</option>
            <option value="Plastic">Plastic</option>
        </select>

        <div id="nameWrapper" style="display:none;">
            <label>Doctor Name</label>
            <select id="nameList"></select>
            <button onclick="submitData()">Confirm Duty</button>
        </div>
        <div id="loader" class="loading">Fetching names from Google Sheets...</div>
    </div>
</div>

<script>
    const SCRIPT_URL = "YOUR_NEW_DEPLOYED_URL";

    function unlock() {
        const pass = document.getElementById('pass').value;
        if(pass === "123") { // Your password
            document.getElementById('loginSection').style.display = 'none';
            document.getElementById('formSection').style.display = 'block';
        } else { alert("Unauthorized access."); }
    }

    async function fetchNames() {
        const spec = document.getElementById('specialty').value;
        if (!spec) return;
        document.getElementById('loader').style.display = 'block';

        try {
            const response = await fetch(SCRIPT_URL, {
                method: 'POST',
                body: JSON.stringify({ action: "getNames", specialty: spec })
            });
            const names = await response.json();
            const list = document.getElementById('nameList');
            list.innerHTML = names.map(n => `<option value="${n}">${n}</option>`).join('');
            document.getElementById('nameWrapper').style.display = 'block';
        } catch (e) {
            alert("Connection Error. Check Script URL and Permissions.");
        } finally {
            document.getElementById('loader').style.display = 'none';
        }
    }

    async function submitData() {
        const payload = {
            action: "submitDuty",
            password: document.getElementById('pass').value,
            specialty: document.getElementById('specialty').value,
            name: document.getElementById('nameList').value
        };
        const res = await fetch(SCRIPT_URL, { method: 'POST', body: JSON.stringify(payload) });
        const result = await res.text();
        alert(result);
    }
</script>
</body>
</html>
